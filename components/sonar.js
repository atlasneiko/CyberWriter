sonarTemplate = document.createElement('template');
sonarTemplate.innerHTML = `
  <link rel="stylesheet" href="../stylesheet/sonar.css" />

  <div id="sonar">
			<div id="sonar-group-1">
				<div class="sonar-slot">
					<div class="sonar-object" id="ob0"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob1"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob2"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob3"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob4"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob5"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob6"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob7"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob8"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob9"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob10"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob11"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob12"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob13"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob14"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob15"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob16"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob17"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob18"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob19"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob20"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob21"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob22"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob23"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob24"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob25"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob26"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob27"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob28"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob29"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob30"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob31"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob32"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob33"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob34"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob35"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob36"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob37"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob38"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob39"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob40"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob41"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob42"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob43"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob44"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob45"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob46"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob47"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob48"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob49"></div>
				</div>
			</div>
			<div id="pulse">
				<div id="pulse-1">
					<div id="pulse-2"></div>
				</div>
			</div>
			<div id="sonar-group-2">
				<div class="sonar-slot">
					<div class="sonar-object" id="ob50"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob51"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob52"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob53"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob54"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob55"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob56"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob57"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob58"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob59"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob60"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob61"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob62"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob63"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob64"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob65"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob66"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob67"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob68"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob69"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob70"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob71"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob72"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob73"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob74"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob75"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob76"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob77"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob78"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob79"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob80"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob81"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob82"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob83"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob84"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob85"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob86"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob87"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob88"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob89"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob90"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob91"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob92"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob93"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob94"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob95"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob96"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob97"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob98"></div>
				</div>
				<div class="sonar-slot">
					<div class="sonar-object" id="ob99"></div>
				</div>
			</div>
		</div>
`

class SonarRadar extends HTMLElement {
	constructor() {
		super();
		this.attachShadow({ mode: 'open' });
		this.shadowRoot.appendChild(sonarTemplate.content.cloneNode(true));
		document.addEventListener("keyStroke", this.handleInput.bind(this))

		this.map = {}
		this.loading = false;
	}

	handleInput(event) {
		if (!this.loading) {
			this.loading = true;

			const receivedText = event.detail.text.join("").split("<br>").filter(el => el !== "")

			setTimeout(() => {
				this.loading = false;
				// reset this.map
				this.map = {}
				// reset style for all locations
				for (let i = 0; i < 100; i++) {
					this.shadowRoot.querySelector(`#ob${i}`).setAttribute("style", "");
				}
				// generate random locations
				const locations = []
				while (locations.length < receivedText.length) {
					const randomLocation = Math.floor(Math.random() * 100);
					if (!locations.includes(randomLocation)) {
						locations.push(randomLocation)
					}
				}

				const colorArr = [
					"#ff6e27",
					"#fbf665",
					"#73fffe",
					"#6287f8"
				]
				locations.forEach((location, idx) => {
					this.shadowRoot.querySelector(`#ob${location}`).setAttribute("style", `border: ${colorArr[Math.floor(Math.random() * 4)]} dotted ${receivedText[idx].length}px`)
				})
			}, 1500)
		}
	}


	connectedCallback() {

	}

}
window.customElements.define('sonar-radar', SonarRadar)

// border: ${colorArr[Math.floor(Math.random() * 4)]} double ${receivedText[idx].length}



